---
title: 'Lab 11: Modeling for Final Project'
author: "Kenza Slaoui"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document: default
  word_document: default
---

```{r, echo=FALSE}
knitr::opts_chunk$set(error = TRUE)
```

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=F)
options(scipen=999)
library(tidyverse)
library(MASS)
```

# Introduction

In this lab, you will work on the final paper with your groups. Every member of the group should complete one of these documents and submit this to Canvas. The work from each group member should be different, and you should work together to ensure that the work is different. The code chunk below is for loading the data into R and for potentially cleaning the data. 

```{r, warning = FALSE}
library(tidyverse)
NSDUH_data = read_csv("final_NSDUH.csv")

NSDUH_0 = read_csv("NSDUH.csv")

NSDUH_1 = NSDUH_0 %>% dplyr::select(ARRESTED_BOOK = booked, TIMES_ARRESTED_BOOK = NOBOOKY2,
TIMES_SOLD_DRUGS = snysell, TIMES_STOLE = snystole, TIMES_ATTACKED_OTHERS = snyattak, YOUTH_TIMES_FIGHT = yeyfgtsw, YOUTH_TIMES_GUN = yeyhgun, YOUTH_TIMES_SOLD_DRUGS = yeysell, YOUTH_TIMES_STOLE = yeystole, YOUTH_TIMES_ATTACKED_OTHERS = yeyattak, YOUTH_SKIPPED_CLASS = eduskpmon)

NSDUH_2 = NSDUH_1

# Creating a recode function for ever booked variables and changing answers
re_code_times_arrested = function(variable){
  for(i in 1:length(variable)){
    if(variable[i] == 3){
      variable[i] = "3 or more"
    }
    else if(variable[i] %in% c(985, 994, 997, 998, 999)){
      variable[i] = NA
    }
  }
  return(variable)
}

NSDUH_2[,"TIMES_ARRESTED_BOOK"] = re_code_times_arrested(NSDUH_1[["TIMES_ARRESTED_BOOK"]])

# Creating a recode function for illegal activity variables and changing answers

re_code_illegal = function(variable){
  for(i in 1:length(variable)){
    if(variable[i] == 1){
      variable[i] = "never"
    }
    else if(variable[i] == 2){
      variable[i] = "1-2"
    }
    else if(variable[i] == 3){
      variable[i] = "3-5"
    }
    else if(variable[i] == 4){
      variable[i] = "6-9"
    }
    else if(variable[i] == 5){
      variable[i] = "10 or more"
    }
    else {
      variable[i] = NA
    }
  }
  return(variable)
}

ILLEGAL_variables = c("TIMES_SOLD_DRUGS","TIMES_STOLE","TIMES_ATTACKED_OTHERS","YOUTH_TIMES_FIGHT","YOUTH_TIMES_GUN","YOUTH_TIMES_SOLD_DRUGS","YOUTH_TIMES_STOLE","YOUTH_TIMES_ATTACKED_OTHERS")

for(variable_name in ILLEGAL_variables){
  NSDUH_2[,variable_name] = re_code_illegal(NSDUH_1[[variable_name]])
}


Times_variables =  c("TIMES_ARRESTED_BOOK", "TIMES_SOLD_DRUGS", "TIMES_STOLE", "TIMES_ATTACKED_OTHERS")

NSDUH = cbind(NSDUH_data[,-which(names(NSDUH_data) %in% Times_variables)], NSDUH_2[,which(names(NSDUH_2) %in% Times_variables)])
```



## 
```{r}
FIRST_AGE_variables = c("MRJ_FIRST_AGE", "COC_FIRST_AGE", "CRK_FIRST_AGE", "HER_FIRST_AGE", "HAL_FIRST_AGE", "INHL_FIRST_AGE", "METH_FIRST_AGE", "OXY_FIRST_AGE")

DRUGS_EVER = c("MRJ_EVER","COC_EVER","HER_EVER","METH_EVER","CRK_EVER","HAL_EVER","INHL_EVER")

DRUG_FREQ = c("ALC_PER_MONTH", "MRJ_PER_MONTH", "COC_PER_MONTH", "CRK_PER_MONTH", "HER_PER_MONTH", "HAL_PER_MONTH", "INHL_PER_MONTH", "METH_PER_MONTH")

DRUG_DISORDER = c("MRJ_PAST_YEAR", "ALC_PAST_YEAR", "COC_PAST_YEAR", "HER_PAST_YEAR", "HAL_PAST_YEAR", "STM_PAST_YEAR")

# ANY_SUBSTANCE_FIRST_AGE
NSDUH_FIRST_AGE = NSDUH %>% dplyr::select(FIRST_AGE_variables)
NSDUH$ANY_SUBSTANCE_FIRST_AGE = apply(NSDUH_FIRST_AGE, MARGIN = 1, FUN = min, na.rm = T)

# ANY_DRUG_EVER
NSDUH_EVER = NSDUH %>% dplyr::select(DRUGS_EVER)
NSDUH$ANY_DRUG_EVER = apply(NSDUH_EVER, MARGIN = 1, FUN = sum, na.rm = T)
NSDUH = NSDUH %>% mutate(ANY_DRUG_EVER = ifelse(ANY_DRUG_EVER == 0, 0, 1))

# DRUG_FREQ (Per Month)
NSDUH_DRUG_FREQ = NSDUH %>% dplyr::select(DRUG_FREQ)
NSDUH$DRUG_FREQ = apply(NSDUH_DRUG_FREQ, MARGIN = 1, FUN = max, na.rm = T)

#DRUG_DISORDER
NSDUH_DISORDER = NSDUH %>% dplyr::select(DRUG_DISORDER)
NSDUH$DRUG_DISORDER = apply(NSDUH_DISORDER, MARGIN = 1, FUN = sum, na.rm = T)
NSDUH = NSDUH %>% mutate(DRUG_DISORDER = ifelse(DRUG_DISORDER == 0, 0, 1))

#vars of interest
vars_of_interest = c("ALC_PAST_YEAR", "ALC_Age", "AD_DPREV", "PY_Adult_MDE", "Seek_Help_Dep", "NIGHTS_IN_PSYCH_HOS", "NIGHTS_IN_GEN_HOS_PSYCH", "EVER_IN_MILITARY", "AGE_6_CAT", "RACE", "AGE", "EMPLOYMENT_STATUS18", "UNEMPL_REASON", "WEEKS_UNEMPL_PY", "HOURS_WORK", "ARRESTED_BOOK", "TIMES_ARRESTED_BOOK", "TIMES_SOLD_DRUGS", "TIMES_STOLE", "TIMES_ATTACKED_OTHERS", "DANGER_DELIGHT", "RISK_FREQ", "ANY_SUBSTANCE_FIRST_AGE", "MRJ_FIRST_AGE", "COC_FIRST_AGE", "CRK_FIRST_AGE", "HER_FIRST_AGE", "HAL_FIRST_AGE", "INHL_FIRST_AGE", "METH_FIRST_AGE", "OXY_FIRST_AGE","ANY_DRUG_EVER", "MRJ_EVER", "COC_EVER", "HER_EVER", "METH_EVER", "CRK_EVER", "HAL_EVER", "INHL_EVER", "DRUG_FREQ", "ALC_PER_MONTH", "MRJ_PER_MONTH", "COC_PER_MONTH", "CRK_PER_MONTH", "HER_PER_MONTH", "HAL_PER_MONTH", "INHL_PER_MONTH", "METH_PER_MONTH", "DRUG_DISORDER", "MRJ_PAST_YEAR", "COC_PAST_YEAR", "HER_PAST_YEAR", "HAL_PAST_YEAR", "STM_PAST_YEAR")

NSDUH_Q2 = NSDUH  %>% dplyr::select(vars_of_interest) %>% dplyr::filter(!is.na(ARRESTED_BOOK)) %>% dplyr::filter(ANY_SUBSTANCE_FIRST_AGE != Inf) %>% dplyr::filter(DRUG_FREQ != -Inf)

#factors
factors = c("ALC_PAST_YEAR", "AD_DPREV", "PY_Adult_MDE", "Seek_Help_Dep", "EVER_IN_MILITARY", "RACE", "AGE", "EMPLOYMENT_STATUS18", "UNEMPL_REASON", "ARRESTED_BOOK", "TIMES_ARRESTED_BOOK", "TIMES_SOLD_DRUGS", "TIMES_STOLE", "TIMES_ATTACKED_OTHERS", "DANGER_DELIGHT", "RISK_FREQ", "ANY_DRUG_EVER", "MRJ_EVER", "COC_EVER", "HER_EVER", "METH_EVER", "CRK_EVER", "HAL_EVER", "INHL_EVER", "DRUG_DISORDER", "MRJ_PAST_YEAR", "COC_PAST_YEAR", "HER_PAST_YEAR", "HAL_PAST_YEAR", "STM_PAST_YEAR")
  
NSDUH_Q2_factor = NSDUH_Q2 %>% dplyr::mutate(across(factors, as.factor)) %>% dplyr::select(ARRESTED_BOOK, everything())


# Numeric variables
numeric = c("ALC_Age", "NIGHTS_IN_PSYCH_HOS", "NIGHTS_IN_GEN_HOS_PSYCH",  "WEEKS_UNEMPL_PY", "HOURS_WORK", "ANY_SUBSTANCE_FIRST_AGE", "MRJ_FIRST_AGE", "COC_FIRST_AGE", "CRK_FIRST_AGE", "HER_FIRST_AGE", "HAL_FIRST_AGE", "INHL_FIRST_AGE", "METH_FIRST_AGE", "OXY_FIRST_AGE", "DRUG_FREQ", "ALC_PER_MONTH", "MRJ_PER_MONTH", "COC_PER_MONTH", "CRK_PER_MONTH", "HER_PER_MONTH", "HAL_PER_MONTH", "INHL_PER_MONTH", "METH_PER_MONTH")
```

```{r}
# Plots to see dependence between outcome and each numerical variable of interest
plot_1 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(y=ALC_Age, x = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_2 =ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=NIGHTS_IN_PSYCH_HOS, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_3 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=NIGHTS_IN_GEN_HOS_PSYCH, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_4 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=WEEKS_UNEMPL_PY, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_5 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=HOURS_WORK, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_6 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=ANY_SUBSTANCE_FIRST_AGE, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_7 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=MRJ_FIRST_AGE, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_8 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=COC_FIRST_AGE, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_9 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=CRK_FIRST_AGE, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_10 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=HER_FIRST_AGE, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_11 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=HAL_FIRST_AGE, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_12 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=INHL_FIRST_AGE, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_13 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=METH_FIRST_AGE, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_14 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=OXY_FIRST_AGE, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_15 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=DRUG_FREQ, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_16 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=ALC_PER_MONTH, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_17 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=MRJ_PER_MONTH, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_18 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=COC_PER_MONTH, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_19 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=CRK_PER_MONTH, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_20 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=HER_PER_MONTH, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_21 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=HAL_PER_MONTH, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_22 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=INHL_PER_MONTH, y = ARRESTED_BOOK, color = ARRESTED_BOOK))

plot_23 = ggplot(NSDUH_Q2_factor) +
    geom_boxplot(aes(x=METH_PER_MONTH, y = ARRESTED_BOOK, color = ARRESTED_BOOK))


#grid.arrange(plot_1, plot_2, plot_3, plot_4, plot_5, ncol=2) 
plot_1 
plot_2
plot_3
plot_4
plot_5
plot_6
#grid.arrange(plot_7, plot_8, plot_9, plot_10, plot_11, plot_12, plot_13, plot_14, ncol= 3 )
plot_7
plot_8
plot_8
plot_10
plot_11
plot_12
plot_13
plot_14
plot_15
#grid.arrange(plot_16, plot_17, plot_18, plot_19, plot_20, plot_21, plot_22, plot_23, ncol=2 )
plot_16
plot_17
plot_18
plot_19
plot_20
plot_21
plot_22
plot_23

numeric_keep = c("ALC_Age", "NIGHTS_IN_PSYCH_HOS",  "WEEKS_UNEMPL_PY", "ANY_SUBSTANCE_FIRST_AGE", "MRJ_FIRST_AGE", "ALC_PER_MONTH")

#Testing for independence between the outcome and every factor variable of interest
table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, ALC_PAST_YEAR) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + ALC_PAST_YEAR, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, AD_DPREV) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + AD_DPREV, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#independent/dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, PY_Adult_MDE) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + PY_Adult_MDE, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#independent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, Seek_Help_Dep) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + Seek_Help_Dep, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#independent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, EVER_IN_MILITARY) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + EVER_IN_MILITARY, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#independent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, RACE) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + RACE, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, AGE_6_CAT) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + AGE_6_CAT, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, EMPLOYMENT_STATUS18) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + EMPLOYMENT_STATUS18, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, UNEMPL_REASON) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + UNEMPL_REASON, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, TIMES_ARRESTED_BOOK) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + TIMES_ARRESTED_BOOK, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#NO

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, TIMES_SOLD_DRUGS) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + TIMES_SOLD_DRUGS, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, TIMES_STOLE) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + TIMES_STOLE, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#KEEP BUT interaction

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, TIMES_ATTACKED_OTHERS) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + TIMES_ATTACKED_OTHERS, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#KEEP but interaction

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, DANGER_DELIGHT) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + DANGER_DELIGHT, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, RISK_FREQ) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + RISK_FREQ, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, ANY_DRUG_EVER) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + ANY_DRUG_EVER, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#independent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, MRJ_EVER) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + MRJ_EVER, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent


table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, COC_EVER) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + COC_EVER, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#BIG TIME dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, HER_EVER) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + HER_EVER, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, METH_EVER) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + METH_EVER, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#BIG TIME dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, CRK_EVER) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + CRK_EVER, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#BIG TIME dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, HAL_EVER) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + HAL_EVER, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#NO

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, INHL_EVER) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + INHL_EVER, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#NO

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, DRUG_DISORDER) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + DRUG_DISORDER, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#BT dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, MRJ_PAST_YEAR) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + MRJ_PAST_YEAR, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#dependent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, COC_PAST_YEAR) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + COC_PAST_YEAR, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#independent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, HER_PAST_YEAR) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + HER_PAST_YEAR, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#independent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, HAL_PAST_YEAR) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + HAL_PAST_YEAR, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#independent

table = NSDUH_Q2_factor %>% group_by(ARRESTED_BOOK, STM_PAST_YEAR) %>% summarize(n = n())
ct = xtabs(n~ARRESTED_BOOK + STM_PAST_YEAR, table)
mosaicplot(ct, color = T, main = "Mosaic Plot")
summary(ct)
#independent


factors_keep = c("ALC_PAST_YEAR", "Race", "AGE_6_CAT", "EMPLOYMENT_STATUS18", "UNEMPL_REASON", "TIMES_SOLD_DRUGS","TIMES_STOLE", "TIMES_ATTACKED_OTHERS", "DANGER_DELIGHT", "RISK_FREQ", "MRJ_EVER", "COC_EVER", "HER_EVER", "METH_EVER", "CRK_EVER", "DRUG_DISORDER", "MRJ_PAST_YEAR")
```

```{r}
#Try this to overcome the NA problem
NSDUH_test = NSDUH_Q2 %>% dplyr::select(ARRESTED_BOOK, ANY_SUBSTANCE_FIRST_AGE, ANY_DRUG_EVER, DRUG_FREQ, DRUG_DISORDER, DANGER_DELIGHT, RISK_FREQ) %>% na.omit()

# Try This to get the significant variables
COEF=rep(NA,6)
P.VAL=rep(NA,6)
for(j in 1:6){
  individual.mod=glm(ARRESTED_BOOK~.,family = binomial, data=NSDUH_test[,c(1,j+1)])
  COEF[j]=coef(individual.mod)[2]
  P.VAL[j]=summary(individual.mod)$coefficients[2,4]
}

KEEP=P.VAL<0.05
ACTUAL=c(rep("NonZero",10),rep("Zero",190))

tibble(COEF,P.VAL,KEEP) %>% 
  ggplot() +
  geom_point(aes(x=COEF,y=P.VAL,color=KEEP),size=2) +
  geom_hline(yintercept=0.05,linetype="dashed")+
  scale_color_manual(values=c("lightskyblue2","gray"))+
  theme_minimal()

##MODEL_0
#model
#model_Q2_0 = glm(ARRESTED_BOOK ~ ANY_DRUG_EVER + DRUG_FREQ + DRUG_DISORDER + DANGER_DELIGHT + RISK_FREQ, family = binomial, data = na.omit(NSDUH_test))
#summary(model_Q2_0)

factors_keep = c("ALC_PAST_YEAR", "RACE", "AGE_6_CAT", "EMPLOYMENT_STATUS18", "UNEMPL_REASON", "TIMES_SOLD_DRUGS","TIMES_STOLE", "TIMES_ATTACKED_OTHERS", "DANGER_DELIGHT", "RISK_FREQ", "MRJ_EVER", "COC_EVER", "HER_EVER", "METH_EVER", "CRK_EVER", "DRUG_DISORDER", "MRJ_PAST_YEAR")
numeric_keep = c("ALC_Age", "NIGHTS_IN_PSYCH_HOS",  "WEEKS_UNEMPL_PY", "ANY_SUBSTANCE_FIRST_AGE", "MRJ_FIRST_AGE", "ALC_PER_MONTH")

#FACTOR ONLY DF

NSDUH_Q2 = NSDUH  %>% dplyr::select(vars_of_interest) %>% dplyr::filter(!is.na(ARRESTED_BOOK)) %>% dplyr::filter(ANY_SUBSTANCE_FIRST_AGE != Inf) %>% dplyr::filter(DRUG_FREQ != -Inf)

factors_no_book = c("ALC_PAST_YEAR", "AD_DPREV", "PY_Adult_MDE", "Seek_Help_Dep", "EVER_IN_MILITARY", "RACE", "AGE", "EMPLOYMENT_STATUS18", "UNEMPL_REASON", "TIMES_ARRESTED_BOOK", "TIMES_SOLD_DRUGS", "TIMES_STOLE", "TIMES_ATTACKED_OTHERS", "DANGER_DELIGHT", "RISK_FREQ", "ANY_DRUG_EVER", "MRJ_EVER", "COC_EVER", "HER_EVER", "METH_EVER", "CRK_EVER", "HAL_EVER", "INHL_EVER", "DRUG_DISORDER", "MRJ_PAST_YEAR", "COC_PAST_YEAR", "HER_PAST_YEAR", "HAL_PAST_YEAR", "STM_PAST_YEAR")

NSDUH_Q2_factor_no_book = NSDUH_Q2 %>% dplyr::mutate(across(factors_no_book, as.factor)) %>% dplyr::select(ARRESTED_BOOK, everything())

df_1 = NSDUH_Q2_factor %>% dplyr::select(ARRESTED_BOOK, ALC_PAST_YEAR, RACE, AGE_6_CAT, EMPLOYMENT_STATUS18, UNEMPL_REASON, TIMES_SOLD_DRUGS,  TIMES_STOLE, TIMES_ATTACKED_OTHERS, DANGER_DELIGHT, RISK_FREQ, MRJ_EVER, COC_EVER, HER_EVER, METH_EVER, CRK_EVER, DRUG_DISORDER, MRJ_PAST_YEAR)
no_NA_df_1 = na.omit(df_1)
str(no_NA_df_1)

df_1_no_book = NSDUH_Q2_factor_no_book %>% dplyr::select(ARRESTED_BOOK, ALC_PAST_YEAR, RACE, AGE_6_CAT, EMPLOYMENT_STATUS18, UNEMPL_REASON, TIMES_SOLD_DRUGS,  TIMES_STOLE, TIMES_ATTACKED_OTHERS, DANGER_DELIGHT, RISK_FREQ, MRJ_EVER, COC_EVER, HER_EVER, METH_EVER, CRK_EVER, DRUG_DISORDER, MRJ_PAST_YEAR)
no_NA_df_1_no_book = na.omit(df_1_no_book)
str(no_NA_df_1_no_book)

df_1.1 = NSDUH_Q2_factor %>% dplyr::select(ARRESTED_BOOK, ALC_PAST_YEAR, RACE, AGE_6_CAT, EMPLOYMENT_STATUS18, TIMES_SOLD_DRUGS,  TIMES_STOLE, TIMES_ATTACKED_OTHERS, DANGER_DELIGHT, RISK_FREQ, MRJ_EVER, COC_EVER, HER_EVER, METH_EVER, DRUG_DISORDER, MRJ_PAST_YEAR)
no_NA_df_1.1 = na.omit(df_1.1)
str(no_NA_df_1.1)

df_1.1_no_book = NSDUH_Q2_factor_no_book %>% dplyr::select(ARRESTED_BOOK, ALC_PAST_YEAR, RACE, AGE_6_CAT, EMPLOYMENT_STATUS18, TIMES_SOLD_DRUGS,  TIMES_STOLE, TIMES_ATTACKED_OTHERS, DANGER_DELIGHT, RISK_FREQ, MRJ_EVER, COC_EVER, HER_EVER, METH_EVER, DRUG_DISORDER, MRJ_PAST_YEAR)
no_NA_df_1.1_no_book = na.omit(df_1.1_no_book)
str(no_NA_df_1.1_no_book)


#Factor only model (2 models)
model_Q2_1.0 = glm(ARRESTED_BOOK ~ ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + UNEMPL_REASON + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + MRJ_EVER + HER_EVER + METH_EVER + CRK_EVER + DRUG_DISORDER, family = binomial, data = no_NA_df_1)
summary(model_Q2_1.0)

model_Q2_1.1 = glm(ARRESTED_BOOK ~ ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + MRJ_EVER + HER_EVER + METH_EVER + DRUG_DISORDER, family = binomial, data = no_NA_df_1.1)
summary(model_Q2_1.1)

#NUMERIC ONLY DF
df_2 = NSDUH_Q2_factor %>% dplyr::select(ARRESTED_BOOK, ALC_Age, ANY_SUBSTANCE_FIRST_AGE, MRJ_FIRST_AGE, NIGHTS_IN_PSYCH_HOS, WEEKS_UNEMPL_PY, ALC_PER_MONTH)
#Not as many NAs
df_2.2 = NSDUH_Q2_factor %>% dplyr::select(ARRESTED_BOOK, ALC_Age, ANY_SUBSTANCE_FIRST_AGE, MRJ_FIRST_AGE)  
no_NA_df_2.2 = na.omit(df_2.2)
str(no_NA_df_2.2)

df_2.2_no_book = NSDUH_Q2_factor_no_book %>% dplyr::select(ARRESTED_BOOK, ALC_Age, ANY_SUBSTANCE_FIRST_AGE, MRJ_FIRST_AGE)  
no_NA_df_2.2_no_book = na.omit(df_2.2_no_book)
str(no_NA_df_2.2_no_book)

#Numeric Only models (3 models)
model_Q2_2 = glm(ARRESTED_BOOK ~ ALC_Age + NIGHTS_IN_PSYCH_HOS + WEEKS_UNEMPL_PY + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE + ALC_PER_MONTH, family = binomial, data = NSDUH_Q2_factor)
summary(model_Q2_2)
#Do not take

model_Q2_2.2 = glm(ARRESTED_BOOK ~ ALC_Age + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE, family = binomial, data = no_NA_df_2.2)
summary(model_Q2_2.2)


#Factor + Numeric DF

df_3_no_book = NSDUH_Q2_factor_no_book %>% dplyr::select(ARRESTED_BOOK, ALC_PAST_YEAR, RACE, AGE_6_CAT, EMPLOYMENT_STATUS18, UNEMPL_REASON, TIMES_SOLD_DRUGS,  TIMES_STOLE, TIMES_ATTACKED_OTHERS, DANGER_DELIGHT, RISK_FREQ, MRJ_EVER, COC_EVER, HER_EVER, METH_EVER, CRK_EVER, DRUG_DISORDER, MRJ_PAST_YEAR, ALC_Age, ANY_SUBSTANCE_FIRST_AGE, MRJ_FIRST_AGE)
no_NA_df_3_no_book = na.omit(df_3_no_book)
str(no_NA_df_3_no_book)

df_3 = NSDUH_Q2_factor %>% dplyr::select(ARRESTED_BOOK, ALC_PAST_YEAR, RACE, AGE_6_CAT, EMPLOYMENT_STATUS18, UNEMPL_REASON, TIMES_SOLD_DRUGS,  TIMES_STOLE, TIMES_ATTACKED_OTHERS, DANGER_DELIGHT, RISK_FREQ, MRJ_EVER, COC_EVER, HER_EVER, METH_EVER, CRK_EVER, DRUG_DISORDER, MRJ_PAST_YEAR, ALC_Age, ANY_SUBSTANCE_FIRST_AGE, MRJ_FIRST_AGE)
no_NA_df_3 = na.omit(df_3)
str(no_NA_df_3)

df_3.1 = NSDUH_Q2_factor %>% dplyr::select(ARRESTED_BOOK, ALC_PAST_YEAR, RACE, AGE_6_CAT, EMPLOYMENT_STATUS18, TIMES_SOLD_DRUGS,  TIMES_STOLE, TIMES_ATTACKED_OTHERS, DANGER_DELIGHT, RISK_FREQ, MRJ_EVER, COC_EVER, HER_EVER, METH_EVER, DRUG_DISORDER, MRJ_PAST_YEAR, ALC_Age, ANY_SUBSTANCE_FIRST_AGE, MRJ_FIRST_AGE)
no_NA_df_3.1 = na.omit(df_3.1)
str(no_NA_df_3.1)

df_3.1_no_book = NSDUH_Q2_factor_no_book %>% dplyr::select(ARRESTED_BOOK, ALC_PAST_YEAR, RACE, AGE_6_CAT, EMPLOYMENT_STATUS18, TIMES_SOLD_DRUGS,  TIMES_STOLE, TIMES_ATTACKED_OTHERS, DANGER_DELIGHT, RISK_FREQ, MRJ_EVER, COC_EVER, HER_EVER, METH_EVER, DRUG_DISORDER, MRJ_PAST_YEAR, ALC_Age, ANY_SUBSTANCE_FIRST_AGE, MRJ_FIRST_AGE)
no_NA_df_3.1_no_book = na.omit(df_3.1_no_book)
str(no_NA_df_3.1_no_book)


#Factor + Numeric Models (3 models)
model_Q2_3 = glm(ARRESTED_BOOK ~ ALC_Age + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE + ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + UNEMPL_REASON + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + HER_EVER + METH_EVER + CRK_EVER + DRUG_DISORDER , family = binomial, data = no_NA_df_3)
summary(model_Q2_3)

model_Q2_4 = glm(ARRESTED_BOOK ~ ALC_Age + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE + ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + HER_EVER + METH_EVER + DRUG_DISORDER , family = binomial, data = no_NA_df_3.1)
summary(model_Q2_4)

model_Q2_5 = glm(ARRESTED_BOOK ~ ALC_Age + RACE + AGE_6_CAT + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + HER_EVER + METH_EVER + CRK_EVER, family = binomial, data = no_NA_df_3)
summary(model_Q2_5)

model_Q2_6 = glm(ARRESTED_BOOK ~ ALC_Age + RACE + AGE_6_CAT + HER_EVER + METH_EVER + CRK_EVER, family = binomial, data = no_NA_df_3)
summary(model_Q2_6)
```


```{r, warning = F}
#CV
library(tidyverse)
library(modelr)
library(broom)
library(purrr)

set.seed(123)

# model_Q2_1.0

library(caret)
set.seed(123)
train.kfold <- trainControl(method = "cv", number = 25)

mod1 <- train(ARRESTED_BOOK ~ ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + UNEMPL_REASON + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + MRJ_EVER + HER_EVER + METH_EVER + CRK_EVER + DRUG_DISORDER, method = "glm", data = no_NA_df_1, trControl = train.kfold, family=binomial(link=logit))

print(mod1)
#summary(mod1)

mod1_no_book <- train(ARRESTED_BOOK ~ ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + UNEMPL_REASON + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + MRJ_EVER + HER_EVER + METH_EVER + CRK_EVER + DRUG_DISORDER, method = "glm", data = no_NA_df_1_no_book, trControl = train.kfold, family=binomial(link=logit))
print(mod1_no_book)

predictions <- predict(mod1, newdata = no_NA_df_1, type = "raw")
data1 <- mutate(no_NA_df_1, "Predictions" = predictions)

predictions_roc <- predict(mod1_no_book, newdata = no_NA_df_1_no_book, type = "raw")
data1_roc <- mutate(no_NA_df_1_no_book, "Predictions" = predictions_roc)


# model_Q2_1.1 *************
library(caret)
set.seed(123)
train.kfold <- trainControl(method = "cv", number = 25)

mod1.1 <- train(ARRESTED_BOOK ~ ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + MRJ_EVER + HER_EVER + METH_EVER + DRUG_DISORDER, method = "glm", data = no_NA_df_1.1, trControl = train.kfold, family=binomial(link=logit))
print(mod1.1)
#summary(mod1.1)

mod1.1_no_book <- train(ARRESTED_BOOK ~ ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + MRJ_EVER + HER_EVER + METH_EVER + DRUG_DISORDER, method = "glm", data = no_NA_df_1.1_no_book, trControl = train.kfold, family=binomial(link=logit))
print(mod1.1_no_book)

predictions1.1 <- predict(mod1.1, newdata = no_NA_df_1.1, type = "raw")
data1.1 <- mutate(no_NA_df_1.1, "Predictions" = predictions1.1)

predictions1.1_roc <- predict(mod1.1_no_book, newdata = no_NA_df_1.1_no_book, type = "raw")
data1.1_roc <- mutate(no_NA_df_1.1_no_book, "Predictions" = predictions1.1_roc)

#model_Q2_2.2
library(caret)
set.seed(123)
train.kfold <- trainControl(method = "cv", number = 25)

mod2.2 <- train(ARRESTED_BOOK ~ALC_Age + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE, method = "glm", data = no_NA_df_2.2, trControl = train.kfold, family=binomial(link=logit))
print(mod2.2)
#summary(mod2.2)

mod2.2_no_book <- train(ARRESTED_BOOK ~ALC_Age + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE, method = "glm", data = no_NA_df_2.2_no_book, trControl = train.kfold, family=binomial(link=logit))
print(mod2.2_no_book)

predictions2.2 <- predict(mod2.2, newdata = no_NA_df_2.2, type = "raw")
data2.2 <- mutate(no_NA_df_2.2, "Predictions" = predictions2.2)

predictions2.2_roc <- predict(mod2.2_no_book, newdata = no_NA_df_2.2_no_book, type = "raw")
data2.2_roc <- mutate(no_NA_df_2.2_no_book, "Predictions" = predictions2.2_roc)


#model_Q2_3
library(caret)
set.seed(123)
train.kfold <- trainControl(method = "cv", number = 25)

mod3 <- train(ARRESTED_BOOK ~ ALC_Age + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE + ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + UNEMPL_REASON + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + HER_EVER + METH_EVER + CRK_EVER + DRUG_DISORDER, method = "glm", data = no_NA_df_3, trControl = train.kfold, family=binomial(link=logit))
print(mod3)
#summary(mod3)

mod3_no_book <- train(ARRESTED_BOOK ~ ALC_Age + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE + ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + UNEMPL_REASON + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + HER_EVER + METH_EVER + CRK_EVER + DRUG_DISORDER, method = "glm", data = no_NA_df_3_no_book, trControl = train.kfold, family=binomial(link=logit))
print(mod3_no_book)


predictions3 <- predict(mod3, newdata = no_NA_df_3, type = "raw")
data3 <- mutate(no_NA_df_3, "Predictions" = predictions3)

predictions3_roc <- predict(mod3_no_book, newdata = no_NA_df_3_no_book, type = "raw")
data3_roc <- mutate(no_NA_df_3_no_book, "Predictions" = predictions3_roc)


#model_Q2_4 ******************
library(caret)
set.seed(123)
train.kfold <- trainControl(method = "cv", number = 25)

mod4 <- train(ARRESTED_BOOK ~ ALC_Age + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE + ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + HER_EVER + METH_EVER + DRUG_DISORDER, method = "glm", data = no_NA_df_3.1, trControl = train.kfold, family=binomial(link=logit))
print(mod4)
#summary(mod4)

mod4_no_book <- train(ARRESTED_BOOK ~ ALC_Age + ANY_SUBSTANCE_FIRST_AGE + MRJ_FIRST_AGE + ALC_PAST_YEAR + RACE + AGE_6_CAT + EMPLOYMENT_STATUS18 + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + DANGER_DELIGHT + RISK_FREQ + MRJ_PAST_YEAR + HER_EVER + METH_EVER + DRUG_DISORDER, method = "glm", data = no_NA_df_3.1_no_book, trControl = train.kfold, family=binomial(link=logit))
print(mod4_no_book)

predictions4 <- predict(mod4, newdata = no_NA_df_3.1, type = "raw")
data4 <- mutate(no_NA_df_3.1, "Predictions" = predictions4)

predictions4_roc <- predict(mod4_no_book, newdata = no_NA_df_3.1_no_book, type = "raw")
data4_roc <- mutate(no_NA_df_3.1_no_book, "Predictions" = predictions4_roc)


#model_Q2_5
set.seed(123)
train.kfold <- trainControl(method = "cv", number = 25)

mod5 <- train(ARRESTED_BOOK ~ ALC_Age + RACE + AGE_6_CAT + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + HER_EVER + METH_EVER + CRK_EVER, method = "glm", data = no_NA_df_3, trControl = train.kfold, family=binomial(link=logit))
print(mod5)
#summary(mod5)

mod5_no_book <- train(ARRESTED_BOOK ~ ALC_Age + RACE + AGE_6_CAT + TIMES_SOLD_DRUGS + TIMES_STOLE + TIMES_ATTACKED_OTHERS + HER_EVER + METH_EVER + CRK_EVER, method = "glm", data = no_NA_df_3_no_book, trControl = train.kfold, family=binomial(link=logit))
print(mod5_no_book)

predictions5 <- predict(mod5, newdata = no_NA_df_3, type = "raw")
data5 <- mutate(no_NA_df_3, "Predictions" = predictions5)


predictions5_roc <- predict(mod5_no_book, newdata = no_NA_df_3_no_book, type = "raw")
data5_roc <- mutate(no_NA_df_3_no_book, "Predictions" = predictions5_roc)

#model_Q2_6
set.seed(123)
train.kfold <- trainControl(method = "cv", number = 25)

mod6 <- train(ARRESTED_BOOK ~ ALC_Age + RACE + AGE_6_CAT + HER_EVER + METH_EVER + CRK_EVER, method = "glm", data = no_NA_df_3, trControl = train.kfold, family=binomial(link=logit))
print(mod6)
#summary(mod6)


mod6_no_book <- train(ARRESTED_BOOK ~ ALC_Age + RACE + AGE_6_CAT + HER_EVER + METH_EVER + CRK_EVER, method = "glm", data = no_NA_df_3_no_book, trControl = train.kfold, family=binomial(link=logit))
print(mod6_no_book)

predictions6 <- predict(mod6, newdata = no_NA_df_3, type = "raw")
data6 <- mutate(no_NA_df_3, "Predictions" = predictions6)

predictions6_roc <- predict(mod6_no_book, newdata = no_NA_df_3_no_book, type = "raw")
data6_roc <- mutate(no_NA_df_3_no_book, "Predictions" = predictions6_roc)
```


#Table with results
```{r}
Accuracy_1 = 0.7004145
RMSE_1 = 0.4518438 
MAE_1 = 0.4014295

Accuracy_2 = 0.8117596
RMSE_2 = 0.3749928  
MAE_2 = 0.2802209

Accuracy_3 = 0.7923424
RMSE_3 = 0.3978076
MAE_3 = 0.3175548

Accuracy_4 = 0.6967659
RMSE_4 = 0.4510898
MAE_4 = 0.3990255

Accuracy_5 = 0.8098732
RMSE_5 = 0.3742524
MAE_5 = 0.2791485

Accuracy_6 = 0.6833318
RMSE_6 = 0.4524792 
MAE_6 = 0.4050533

Accuracy_7 = 0.683835
RMSE_7 = 0.4525737
MAE_7 = 0.4073333

Accuracy = c(Accuracy_1, Accuracy_2, Accuracy_3, Accuracy_4, Accuracy_5, Accuracy_6, Accuracy_7)

RMSE = c(RMSE_1, RMSE_2, RMSE_3, RMSE_4, RMSE_5, RMSE_6, RMSE_7)

MAE = c(MAE_1, MAE_2, MAE_3, MAE_4, MAE_5, MAE_6, MAE_7)

calculate_classification_results <- function(actual, predicted) {
  correct <- sum(actual == predicted)
  false_positive <- sum(actual == 0 & predicted == 1)
  false_negative <- sum(actual == 1 & predicted == 0)
  true_positive <- sum(actual == 1 & predicted == 1)
  true_negative <- sum(actual == 0 & predicted == 0)
  
  sensitivity <- true_positive / (true_positive + false_negative)
  specificity <- true_negative / (true_negative + false_positive)
  fpr <- false_positive / (false_positive + true_negative)
  fnr <- false_negative / (false_negative + true_positive)
  
  return(data.frame(
    Correct = correct,
    FalsePositive = false_positive,
    FalseNegative = false_negative,
    Sensitivity = sensitivity,
    Specificity = specificity,
    FPR = fpr,
    FNR = fnr
  ))
}

results <- data.frame(Model = character(), Sensitivity = numeric(), Specificity = numeric(), FPR = numeric(), FNR = numeric())
for (model_name in names(model_predictions)) {
  predicted <- round(model_predictions[[model_name]])
  metrics <- calculate_classification_results(results_df$Actual, predicted)
  results <- bind_rows(results, data.frame(Model = model_name, metrics))
}

# model 1
results_df <- data.frame(Actual = data1$ARRESTED_BOOK)
results_df[[paste0("predicted_", "model_1")]] <- data1$Predictions

results <- data.frame(Model = character(), Sensitivity = numeric(), Specificity = numeric(), FPR = numeric(), FNR = numeric())
predicted <- data1$Predictions
metrics <- calculate_classification_results(results_df$Actual, predicted)
results <- bind_rows(results, data.frame(Model = "model_1", metrics))[,-c(6,7,8)] 

# model 2
results_df_1.1 <- data.frame(Actual = data1.1$ARRESTED_BOOK)
results_df_1.1[[paste0("predicted_", "model_2")]] <- data1.1$Predictions

results_1.1 <- data.frame(Model = character(), Sensitivity = numeric(), Specificity = numeric(), FPR = numeric(), FNR = numeric())
predicted_1.1 <- data1.1$Predictions
metrics_1.1 <- calculate_classification_results(results_df_1.1$Actual, predicted_1.1)
results_1.1 <- bind_rows(results_1.1, data.frame(Model = "model_2", metrics))[,-c(6,7,8)] 

# 3
results_df_2 <- data.frame(Actual = data2.2$ARRESTED_BOOK)
results_df_2[[paste0("predicted_", "model_3")]] <- data2.2$Predictions

results_2 <- data.frame(Model = character(), Sensitivity = numeric(), Specificity = numeric(), FPR = numeric(), FNR = numeric())
predicted_2 <- data2.2$Predictions
metrics_2 <- calculate_classification_results(results_df_2$Actual, predicted_2)
results_2 <- bind_rows(results_2, data.frame(Model = "model_3", metrics_2))[,-c(6,7,8)] 


# 4

results_df_3 <- data.frame(Actual = data3$ARRESTED_BOOK)
results_df_3[[paste0("predicted_", "model_4")]] <- data3$Predictions
results_long_3 <- results_df_3 %>%
  pivot_longer(cols = starts_with("predicted"), names_to = "Model", values_to = "Predicted")


results_3 <- data.frame(Model = character(), Sensitivity = numeric(), Specificity = numeric(), FPR = numeric(), FNR = numeric())
predicted_3 <- data3$Predictions
metrics_3 <- calculate_classification_results(results_df_3$Actual, predicted_3)
results_3 <- bind_rows(results_3, data.frame(Model = "model_4", metrics_3))[,-c(6,7,8)] 

# 5

results_df_4 <- data.frame(Actual = data4$ARRESTED_BOOK)
results_df_4[[paste0("predicted_", "model_5")]] <- data4$Predictions
results_long_4 <- results_df_4 %>%
  pivot_longer(cols = starts_with("predicted"), names_to = "Model", values_to = "Predicted")


results_4 <- data.frame(Model = character(), Sensitivity = numeric(), Specificity = numeric(), FPR = numeric(), FNR = numeric())
predicted_4 <- data4$Predictions
metrics_4 <- calculate_classification_results(results_df_4$Actual, predicted_4)
results_4 <- bind_rows(results_4, data.frame(Model = "model_5", metrics_4))[,-c(6,7,8)]

# 6

results_df_5 <- data.frame(Actual = data5$ARRESTED_BOOK)
results_df_5[[paste0("predicted_", "model_6")]] <- data5$Predictions
results_long_5 <- results_df_5 %>%
  pivot_longer(cols = starts_with("predicted"), names_to = "Model", values_to = "Predicted")


results_5 <- data.frame(Model = character(), Sensitivity = numeric(), Specificity = numeric(), FPR = numeric(), FNR = numeric())
predicted_5 <- data5$Predictions
metrics_5 <- calculate_classification_results(results_df_5$Actual, predicted_5)
results_5 <- bind_rows(results_5, data.frame(Model = "model_6", metrics_5))[,-c(6,7,8)]


# 7

results_df_6 <- data.frame(Actual = data6$ARRESTED_BOOK)
results_df_6[[paste0("predicted_", "model_7")]] <- data6$Predictions
results_long_6 <- results_df_6 %>%
  pivot_longer(cols = starts_with("predicted"), names_to = "Model", values_to = "Predicted")


results_6 <- data.frame(Model = character(), Sensitivity = numeric(), Specificity = numeric(), FPR = numeric(), FNR = numeric())
predicted_6 <- data6$Predictions
metrics_6 <- calculate_classification_results(results_df_6$Actual, predicted_6)
results_6 <- bind_rows(results_6, data.frame(Model = "model_7", metrics_6))[,-c(6,7,8)]

final_results = rbind(results, results_1.1, results_2, results_3, results_4, results_5, results_6) %>% mutate(Accuracy = Accuracy, RMSE = RMSE, MAE = MAE) 

output = final_results %>%
  kable(align = "c") %>%
  kable_styling(bootstrap_options = "striped") 

#ggplot(final_results) +
  #geom_curve(aes(y=Sensitivity, x=Specificity, color = Model))


# ROC

library(ggplot2)
library(pROC)

#define object to plot and calculate AUC
roc_1 <- roc(data1_roc$ARRESTED_BOOK, data1_roc$Predictions)
roc_2 <- roc(data1.1_roc$ARRESTED_BOOK, data1.1_roc$Predictions)
roc_3 <- roc(data2.2_roc$ARRESTED_BOOK, data2.2_roc$Predictions)
roc_4 <- roc(data3_roc$ARRESTED_BOOK, data3_roc$Predictions)
roc_5 <- roc(data4_roc$ARRESTED_BOOK, data4_roc$Predictions)
roc_6 <- roc(data5_roc$ARRESTED_BOOK, data5_roc$Predictions)
roc_7 <- roc(data6_roc$ARRESTED_BOOK, data6_roc$Predictions)

auc_1 <- round(auc(data1_roc$ARRESTED_BOOK, data1_roc$Predictions),3)
auc_2 <- round(auc(data1.1_roc$ARRESTED_BOOK, data1.1_roc$Predictions),3)
auc_3 <- round(auc(data2.2_roc$ARRESTED_BOOK, data2.2_roc$Predictions),3)
auc_4 <- round(auc(data3_roc$ARRESTED_BOOK, data3_roc$Predictions),3)
auc_5 <- round(auc(data4_roc$ARRESTED_BOOK, data4_roc$Predictions),3)
auc_6 <- round(auc(data5_roc$ARRESTED_BOOK, data5_roc$Predictions),3)
auc_7 <- round(auc(data6_roc$ARRESTED_BOOK, data6_roc$Predictions),3)


#create ROC plot

ggroc(list(`mod 1`=roc_1, `mod 2`=roc_2, `mod 3`=roc_3, `mod 4`=roc_4, `mod 5`=roc_5, `mod 6`=roc_6, `mod 7`=roc_7), size=0.8) + 
theme_bw() + 
theme(legend.title = element_blank(), 
      legend.position = c(0.8, 0.2),
      legend.text = element_text(size=12),
      text = element_text(size=12)) + 
      scale_color_manual(values=c("#000000", "#0072B2", "#E69F00", "#CC79A7", "#FF0000", "#0000FF", "#00FF00"),
                         labels=c(paste("mod 1 AUC: ", auc_1, sep=""), 
                                  paste("mod 2 AUC: ", auc_2, sep=""), 
                                  paste("mod 3 AUC: ", auc_3, spe=""),
                                  paste("mod 4 AUC: ", auc_4, spe=""),
                                  paste("mod 5 AUC: ", auc_5, spe=""),
                                  paste("mod 6 AUC: ", auc_6, spe=""),
                                  paste("mod 7 AUC: ", auc_7, spe=""))
                          ) +
      labs(title="", x="Specificity", y="Sensitivity")

output
```